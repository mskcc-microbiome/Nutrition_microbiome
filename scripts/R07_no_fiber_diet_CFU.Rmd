---
title: "No fiber diet CFU counts"
output: html_document
date: "2024-08-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggpubr)
library(readxl)
library(janitor)
library(scales)
```
B+S  (Biapenem + Sucrose) PS (PBS + Sucrose) BP (Biapenem +Plain Hydrogel) and PP (PBS + Plain Hydrogel)

```{r}
# nofiber <- read_excel('../../MSS_pipeline-/scripts/food_tree/data/Angel Rebuttal_Exp2.xlsx') %>% 
#   clean_names() %>% 
#   filter(experiment == 2) %>% 
#   select(-tube_label, -date,-x14)
# nofiber %>% write_csv('../data/R07_no_fiber_experiment_data_CFU.csv')

nofiber <- read_csv('../data/R07_no_fiber_experiment_data_CFU.csv') %>% 
  mutate(CFUs_per_GramStool = (((((colonies_counted*(100/plated_volume_ul))/100)/(10^dilution_factor) )*1000)/stool_weight_mg)) %>% 
  mutate(treatment = str_replace(treatment, '\\d$',''),
         abx_treatment = if_else(str_detect(treatment, '^B'), 'biapenem','DPBS') ,
         diet_treatment = if_else(str_detect(treatment, 'S$'), 'sucrose', 'vehicle'),
         diet_treatment = factor(diet_treatment, levels = c('vehicle','sucrose')),
         abx_treatment = factor(abx_treatment, levels = c('DPBS','biapenem')))
#nofiber %>% distinct(treatment, abx_treatment, diet_treatment)
nofiber %>% distinct(day)

plotdf <- nofiber %>% 
  mutate(day = factor(day)) %>% 
  arrange(abx_treatment,diet_treatment,  day) %>% 
  mutate(xvar = str_glue('{abx_treatment}__{diet_treatment}__{day}')) %>% 
  mutate(grp = str_glue('{abx_treatment}__{diet_treatment}')) %>% 
  mutate(grp = factor(grp, levels = c('DPBS__vehicle','DPBS__sucrose','biapenem__vehicle','biapenem__sucrose')))
```


```{r}
nofiber_days <- plotdf %>%    
  ggboxplot(x = 'xvar', y = 'CFUs_per_GramStool',add = 'jitter', xlab = '', 
            ylab = 'Enterococcal\n CFU/gram',, add.params = list(alpha = 0.5, shape = 16),
            width = 0.6,color  = 'grp')+
   scale_color_manual(values = c('gray76','#ffbcdc','gray32','deeppink2')) +
  stat_compare_means(comparisons = list(c('biapenem__vehicle__3','biapenem__sucrose__3'), c('biapenem__vehicle__6','biapenem__sucrose__6')),label= "p.signif", method= 'wilcox.test',tip.length = 0.04,exact=T,correct=T) +
  scale_y_log10(breaks = c(1 %o% 10^(-1:12)),  labels = trans_format("log10", math_format(10^.x))) +
  #scale_x_discrete(labels=rep(c(0,3,6,9),4)) + 
  theme(axis.text =  element_text(size = 10, angle = 45, hjust = 1),
        axis.title=element_text(size=10),legend.position = 'none',aspect.ratio=1/1.3)
nofiber_days
```

