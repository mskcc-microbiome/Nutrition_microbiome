---
title: "New mice"
output: html_document
date: "2025-07-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(janitor)
library(cowplot)
library(patchwork)
library(scales)
```
```{r}
library(vdbR)
connect_database('~/dbConfig_example.txt')
list_table_from_database()
get_table_from_database('allbmt_medsrx')
get_table_from_database('asv_alpha_diversity_ag')
```

```{r}
dat <- read_csv('../data/7_9_25Biapenem Rebuttal Experiment.csv') %>% 
  filter(!is.na(Total_weight_stool_and_tube_mg) ) %>% 
  mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1)  %>%
  clean_names() %>%
  mutate(logCFU = log10(cf_us_per_gram_stool)) %>% 
  select(experiment:mouse_identifier, logCFU) %>% 
  filter(str_detect(treatment, 'Biapenem'))


plot_data <- dat %>%
  mutate(
    treatment = factor(treatment, levels = c("Biapenem_Only", "Biapenem_Sucrose"))
  )

# Create the plot using ggplot2
ggplot(plot_data, aes(x = factor(day), y = logCFU)) +
  # First, draw the lines for each individual mouse.
  # The `group = mouse_identifier` is the key aesthetic that tells ggplot
  # to connect the points belonging to each mouse.
  geom_line(
    aes(group = mouse_identifier),
    color = "gray50", # A neutral color for the background lines
    alpha = 0.9     # Make them slightly transparent
  ) +
  # Add individual points for each measurement
  geom_point(
    alpha = 0.9,
    color = "gray50"
  ) +
  # Now, overlay the boxplots on top.
  # The `fill` adds some color, and `alpha` makes them semi-transparent
  # so the lines and points underneath remain visible.
  geom_boxplot(
    aes(fill = treatment),
    outlier.shape = NA, # Hides the outlier points, as we are already plotting all points
    alpha = 0.7
  ) +
  # Create separate plot panels for each treatment group.
  facet_grid(group~treatment) +
  # Use a nice color scheme and remove the fill legend since the
  # panel titles already provide that information.
  scale_fill_manual(values = c("Biapenem_Only" = "#82B3A8", "Biapenem_Sucrose" = "#E09C6C"), guide = "none") +
  # Add informative labels and a title.
  labs(
    title = "Enterococcus Growth Over Time by Treatment",
    subtitle = "Lines connect measurements from individual mice",
    x = "Day",
    y = "Enterococcus Abundance (log CFU/gram)"
  ) +
  # Use a clean, classic theme.
  theme_bw(base_size = 12) +
  # Make some final theme adjustments.
  theme(
    plot.title = element_text(face = "bold", size = 16),
    strip.text = element_text(face = "bold", size = 12), # Makes panel titles bold
    legend.position = "none" # No legend needed
  )

ggsave('../data/R31_room_counts.pdf', width = 7, height = 12)
```

```{r}
fc_data <- dat %>% 
  mutate(day = str_glue('day{day}')) %>% 
  spread('day','logCFU') %>% 
  mutate(fc = day6/day0)

max_finite_fc <- fc_data %>%
  filter(is.finite(fc)) %>%
  summarise(max_val = max(fc)) %>%
  pull(max_val)

plot_data <- fc_data %>%
  mutate(
    # Replace Inf with a value 10% higher than the max finite value
    fc_plot = if_else(is.infinite(fc), max_finite_fc * 1.1, fc),
    # Create a new column to indicate which points were originally infinite
    is_inf = is.infinite(fc)
  )

# Create the plot using ggplot2
ggplot(plot_data, aes(x = treatment, y = fc_plot, fill = treatment)) +
  # Add boxplots to show the distribution of fold changes
  geom_boxplot(
    alpha = 0.6,
    outlier.shape = NA # We will plot all points with geom_jitter
  ) +
  # Add jittered points to show each individual mouse.
  # We can use a different shape for the points that were originally infinite.
  geom_jitter(
    aes(shape = is_inf),
    width = 0.2,
    size = 2.5,
    alpha = 0.8
  ) +
  # Create separate plot panels for each experimental group
  facet_wrap(~group) +
  # Use a log10 scale for the y-axis, which is standard for fold-change data
  scale_y_log10(
    name = "Fold Change (log10 scale)",
    # Add a horizontal line at y=1 for reference (no change)
    breaks = c(0.1, 1, 10, 100),
    labels = c("0.1", "1", "10", "100")
  ) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "gray30") +
  # Customize the shapes used for the points
  scale_shape_manual(
    name = "",
    values = c(`FALSE` = 21, `TRUE` = 24), # Circle for finite, triangle for infinite
    labels = c(`FALSE` = "Finite FC", `TRUE` = "Infinite FC (Capped)"),
    guide = guide_legend(override.aes = list(fill = "gray50"))
  ) +
  stat_compare_means(
    method = "wilcox.test",
    comparisons = list(c("Biapenem_Only", "Biapenem_Sucrose")),
    label = "p.format" # Display the p-value in a standard format
  ) +
  # Customize the fill colors for the boxplots
  scale_fill_manual(
    name = "Treatment",
    values = c("Biapenem_Only" = "#82B3A8", "Biapenem_Sucrose" = "#E09C6C")
  ) +
  # Add informative labels and a title
  labs(
    title = "Enterococcus Fold Change from Day 0 to Day 6",
    subtitle = "Faceted by Jax room",
    x = ""
  ) +
  # Use a clean, classic theme
  theme_bw(base_size = 12) +
  # Make some final theme adjustments
  theme(
    plot.title = element_text(face = "bold", size = 16),
    strip.text = element_text(face = "bold", size = 11),
    axis.text.x = element_text(angle = 25, hjust = 1),
    legend.position = "bottom"
  )

ggsave('../data/R31_foldchange.jpg', width = 7, height = 9)
```

# old mice

```{r}
newest <- readxl::read_excel('../data/Sucrose_All Experiments Consolidated .xlsx') %>% 
  mutate(Log_CFUs_per_GramStool = log10((((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1) ) %>%   
  filter(Day != 1) %>%  
  separate(Treatment, into = c('diet_treatment','abx_treatment'), sep = ', ', remove = T) %>% 
  mutate(diet_treatment = if_else(diet_treatment == 'Vehicle','vehicle','sucrose'),
         abx_treatment = if_else(str_detect(abx_treatment, 'Bia'),'biapenem',abx_treatment),
         diet_treatment = factor(diet_treatment, levels = c('vehicle','sucrose')),
         abx_treatment = factor(abx_treatment, levels = c('PBS','biapenem'))) %>% 
  mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1) %>% 
  select(Experiment:Mouse_identifier, CFUs_per_GramStool, Log_CFUs_per_GramStool)

newest %>% count(Experiment, Treatment)
```

# room, only replated RB08 including the sucrose and control group as they were also from RB08 

```{r}
experiment_data <- read_csv('../data/7_9_25Biapenem Rebuttal Experiment_updated.csv') %>% 
  filter(Group == 'RB08'| Group == 'sucrose' | Group == 'control') %>% 
  mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1)  %>%
  clean_names() %>%
  mutate(logCFU = log10(cf_us_per_gram_stool)) 
```
```{r}
processed_data <- experiment_data %>%
  # The value '0' can't be plotted on a log scale. We'll replace it with a small number (e.g., 1)
  # to include it in the plot, as is common practice.
  mutate(cf_us_per_gram_stool = if_else(cf_us_per_gram_stool == 0, 1, cf_us_per_gram_stool)) %>%
  # Create separate columns for 'antibiotic_treatment' and 'diet_treatment' from the 'group' column.
  mutate(
    antibiotic_treatment = case_when(
      str_detect(treatment, "Biapenem") ~ "biapenem",
      str_detect(treatment, "PBS") ~ "PBS",
      TRUE ~ "Unknown"
    ),
    diet_treatment = case_when(
      str_detect(treatment, "Sucrose") ~ "sucrose",
      str_detect(treatment, "Only") ~ "vehicle",
      TRUE ~ "Unknown"
    ),
    # Ensure the treatments are ordered correctly for the plot layout.
    antibiotic_treatment = factor(antibiotic_treatment, levels = c("PBS", "biapenem")),
    diet_treatment = factor(diet_treatment, levels = c("vehicle", "sucrose"))
  ) %>%
  # Create a single grouping variable for the x-axis by combining the treatment and day information.
  mutate(
    plot_group = paste(antibiotic_treatment, diet_treatment, day, sep = "_"),
    # Create a unique ID for each mouse's trajectory within its specific treatment group.
    trajectory_group = paste(antibiotic_treatment, diet_treatment, mouse_identifier, sep = "_")
  ) %>%
  # Convert the new grouping variable to a factor and set the levels to enforce the desired plot order.
  mutate(
    plot_group = factor(plot_group, levels = c(
      "PBS_vehicle_0", "PBS_vehicle_3", "PBS_vehicle_6",
      "PBS_sucrose_0", "PBS_sucrose_3", "PBS_sucrose_6",
      "biapenem_vehicle_0", "biapenem_vehicle_3", "biapenem_vehicle_6",
      "biapenem_sucrose_0", "biapenem_sucrose_3", "biapenem_sucrose_6"
    ))
  )
```


```{r}
# --- Plotting ---
# Generate the plot using ggplot2
ggplot(processed_data, aes(x = plot_group, y = cf_us_per_gram_stool, fill = diet_treatment)) +
  
  # Add vertical lines to visually separate the main treatment blocks.
  geom_vline(xintercept = c(3.5, 6.5, 9.5), color = "gray80", linetype = "dashed") +

  # Add boxplots. The fill color is mapped to the diet treatment.
  # Outliers are not plotted here as geom_jitter will show all individual points.
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  
   # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray50", linewidth = 0.5, alpha = 0.7) +
  
  # Add individual data points with some horizontal jitter to prevent overlap.
  geom_point(aes(color = diet_treatment), width = 0.2, size = 2) +
  
  # Use a logarithmic scale for the y-axis, which is essential for this type of CFU data.
  # We customize the labels to show scientific notation (10^2, 10^3, etc.).
  scale_y_log10(
    breaks = scales::trans_breaks("log10", function(x) 10^x, n = 9),
    labels = scales::trans_format("log10", scales::math_format(10^.x))
  ) +
  
  # Set the x-axis tick labels to show the day for each group.
  scale_x_discrete(labels = rep(c("0", "3", "6"), 4)) +
  
  # Manually set the colors to match the publication figure (gray for vehicle, pink for sucrose).
  scale_fill_manual(values = c("vehicle" = "gray", "sucrose" = "#FF69B4")) +
  scale_color_manual(values = c("vehicle" = "gray40", "sucrose" = "red")) +
  
  # Add labels for the axes and title.
  labs(
    y = "Enterococcal\nCFU/gram",
    x = "Treatment Group",
    title = "RB08"
  ) +
  
  # Add annotations below the x-axis to label the main groups.
  annotate("text", x = 2, y = 0.1, label = "PBS\nvehicle", size = 3.5) +
  annotate("text", x = 5, y = 0.1, label = "PBS\nsucrose", size = 3.5) +
  annotate("text", x = 8, y = 0.1, label = "Biapenem\nvehicle", size = 3.5) +
  annotate("text", x = 11, y = 0.1, label = "Biapenem\nsucrose", size = 3.5) +
  
  # Apply a clean, classic theme suitable for publication.
  theme_classic() +
  
  # Further theme adjustments for a polished look.
  theme(
    axis.title = element_text(size = 12),
    axis.text.x = element_text(size = 10, vjust = -1), # Adjust position of day numbers
    axis.text.y = element_text(size = 10),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "none" # Hide the legend as the colors are explained by the fill.
  ) +
  # Extend the plot margin to make room for the annotations.
  coord_cartesian( clip = "off")


```

# weight data 

```{r}
weight_data <- readxl::read_excel('../data/7_9_25 weights_biapenem_rebuttal_experiment.xlsx') %>% 
  clean_names() %>% 
  mutate(group = if_else(str_detect(treatment, 'PBS'), 'RB08', group)) %>% 
  rename(room = group)

processed_weights <- weight_data %>%
  # Determine the number of unique treatments within each room.
  group_by(room) %>%
  mutate(n_treatments = n_distinct(treatment)) %>%
  ungroup() %>%
  # Create a numeric ordering column based on the user's conditional logic.
  mutate(
    treatment_order = case_when(
      # For rooms with 4 treatments (CFU plot order)
      n_treatments == 4 & treatment == "PBS_vehicle" ~ 1,
      n_treatments == 4 & treatment == "PBS_sucrose" ~ 2,
      n_treatments == 4 & treatment == "Biapenem_Only" ~ 3,
      n_treatments == 4 & treatment == "Biapenem_Sucrose" ~ 4,
      # For rooms with 2 treatments
      n_treatments == 2 & treatment == "Biapenem_Only" ~ 1,
      n_treatments == 2 & treatment == "Biapenem_Sucrose" ~ 2,
      TRUE ~ 99 # Default case
    ),
    # Create a unique group for each mouse's trajectory.
    trajectory_group = paste(room, treatment,  mouse_identifier, sep = "_"),
    # Create the group for the x-axis, then reorder it based on our custom logic.
    plot_group = paste(treatment, day, sep = "_"),
    plot_group = fct_reorder(plot_group, treatment_order)
  )
```


```{r}
# --- Plotting ---
# Generate the plot using ggplot2
ggplot(processed_weights, aes(x = plot_group, y = weight)) +
  
  # Add boxplots to show the distribution of weights.
  geom_boxplot(aes(fill = treatment), outlier.shape = NA, alpha = 0.6) +
  
  # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray20", linewidth = 0.5, alpha = 0.7) +
  
  # Add individual data points.
  geom_jitter(aes(color = treatment), width = 0.1, size = 2, alpha = 0.8) +
  
  # Create separate panels for each room, allowing the x-axis to adjust.
  facet_wrap(~ room, scales = "free_x", nrow = 1) +
  
  # Manually set colors to distinguish treatments.
  scale_fill_brewer(palette = "Pastel1") +
  scale_color_brewer(palette = "Set1") +
  
  # Add labels for the axes and title.
  labs(
    title = "Mouse Weight Trajectories Across Rooms and Treatments",
    x = "Day of Experiment",
    y = "Weight (grams)"
  ) +
  
  # Apply a clean, minimal theme.
  theme_bw() +
  
  # Further theme adjustments for a polished look.
  theme(
    strip.text = element_text(size = 10, face = "bold"), # Facet labels
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), # Rotate labels for readability
    legend.position = "none"
  )


```
# RB07 in May  

```{r}
experiment_data <- read_csv('../data/Biapenem_Testing_May_2025.csv') %>% 
  filter(!is.na(Stool_weight_mg)) %>% 
  mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1)  %>%
  clean_names() %>%
  mutate(logCFU = log10(cf_us_per_gram_stool)) 

processed_data <- experiment_data %>%
  # The value '0' can't be plotted on a log scale. We'll replace it with a small number (e.g., 1)
  # to include it in the plot, as is common practice.
  mutate(cf_us_per_gram_stool = if_else(cf_us_per_gram_stool == 0, 1, cf_us_per_gram_stool)) %>%
  # Create separate columns for 'antibiotic_treatment' and 'diet_treatment' from the 'group' column.
  mutate(
    antibiotic_treatment = case_when(
      str_detect(treatment, "Biapenem") ~ "biapenem",
      str_detect(treatment, "PBS") ~ "PBS",
      TRUE ~ "Unknown"
    ),
    diet_treatment = case_when(
      str_detect(treatment, "Sucrose") ~ "sucrose",
      str_detect(treatment, "Plain_Hydrogel") ~ "vehicle",
      TRUE ~ "Unknown"
    ),
    # Ensure the treatments are ordered correctly for the plot layout.
    antibiotic_treatment = factor(antibiotic_treatment, levels = c("PBS", "biapenem")),
    diet_treatment = factor(diet_treatment, levels = c("vehicle", "sucrose"))
  ) %>%
  # Create a single grouping variable for the x-axis by combining the treatment and day information.
  mutate(
    plot_group = paste(antibiotic_treatment, diet_treatment, day, sep = "_"),
    # Create a unique ID for each mouse's trajectory within its specific treatment group.
    trajectory_group = paste(antibiotic_treatment, diet_treatment, mouse_identifier, sep = "_")
  ) %>%
  # Convert the new grouping variable to a factor and set the levels to enforce the desired plot order.
  mutate(
    plot_group = factor(plot_group, levels = c(
      "PBS_vehicle_0", "PBS_vehicle_3", "PBS_vehicle_6",
      "PBS_sucrose_0", "PBS_sucrose_3", "PBS_sucrose_6",
      "biapenem_vehicle_0", "biapenem_vehicle_3", "biapenem_vehicle_6",
      "biapenem_sucrose_0", "biapenem_sucrose_3", "biapenem_sucrose_6"
    ))
  )

ggplot(processed_data, aes(x = plot_group, y = cf_us_per_gram_stool, fill = diet_treatment)) +
  
  # Add vertical lines to visually separate the main treatment blocks.
  geom_vline(xintercept = c(3.5, 6.5, 9.5), color = "gray80", linetype = "dashed") +

  # Add boxplots. The fill color is mapped to the diet treatment.
  # Outliers are not plotted here as geom_jitter will show all individual points.
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  
   # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray50", linewidth = 0.5, alpha = 0.7) +
  
  # Add individual data points with some horizontal jitter to prevent overlap.
  geom_point(aes(color = diet_treatment), width = 0.2, size = 2) +
  
  # Use a logarithmic scale for the y-axis, which is essential for this type of CFU data.
  # We customize the labels to show scientific notation (10^2, 10^3, etc.).
  scale_y_log10(
    breaks = scales::trans_breaks("log10", function(x) 10^x, n = 9),
    labels = scales::trans_format("log10", scales::math_format(10^.x))
  ) +
  
  # Set the x-axis tick labels to show the day for each group.
  scale_x_discrete(labels = rep(c("0", "3", "6"), 4)) +
  
  # Manually set the colors to match the publication figure (gray for vehicle, pink for sucrose).
  scale_fill_manual(values = c("vehicle" = "gray", "sucrose" = "#FF69B4")) +
  scale_color_manual(values = c("vehicle" = "gray40", "sucrose" = "red")) +
  
  # Add labels for the axes and title.
  labs(
    y = "Enterococcal\nCFU/gram",
    x = "Treatment Group",
    title = "RB07 in May"
  ) +
  
  # Add annotations below the x-axis to label the main groups.
  annotate("text", x = 2, y = 0.1, label = "PBS\nvehicle", size = 3.5) +
  annotate("text", x = 5, y = 0.1, label = "PBS\nsucrose", size = 3.5) +
  annotate("text", x = 8, y = 0.1, label = "Biapenem\nvehicle", size = 3.5) +
  annotate("text", x = 11, y = 0.1, label = "Biapenem\nsucrose", size = 3.5) +
  
  # Apply a clean, classic theme suitable for publication.
  theme_classic() +
  
  # Further theme adjustments for a polished look.
  theme(
    axis.title = element_text(size = 12),
    axis.text.x = element_text(size = 10, vjust = -1), # Adjust position of day numbers
    axis.text.y = element_text(size = 10),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "none" # Hide the legend as the colors are explained by the fill.
  ) +
  # Extend the plot margin to make room for the annotations.
  coord_cartesian( clip = "off")
```
# RB07 in Feb

I think this is a no fiber experiment

```{r}
experiment_data <- readxl::read_excel('../data/No Fiber CFU MetaData 2025 2.xlsx') %>% 
  filter(!is.na(Stool_weight_mg)) %>% 
  mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1)  %>%
  clean_names() %>%
  mutate(logCFU = log10(cf_us_per_gram_stool)) 


processed_data <- experiment_data %>%
  # The value '0' can't be plotted on a log scale. We'll replace it with a small number (e.g., 1)
  # to include it in the plot, as is common practice.
  mutate(cf_us_per_gram_stool = if_else(cf_us_per_gram_stool == 0, 1, cf_us_per_gram_stool)) %>%
  # Create separate columns for 'antibiotic_treatment' and 'diet_treatment' from the 'group' column.
  mutate(
    antibiotic_treatment = case_when(
      str_detect(treatment, "Biapenem") ~ "biapenem",
      str_detect(treatment, "PBS") ~ "PBS",
      TRUE ~ "Unknown"
    ),
    diet_treatment = case_when(
      str_detect(treatment, "Sucrose") ~ "sucrose",
      str_detect(treatment, "Plain_Hydrogel") ~ "vehicle",
      TRUE ~ "Unknown"
    ),
    # Ensure the treatments are ordered correctly for the plot layout.
    antibiotic_treatment = factor(antibiotic_treatment, levels = c("PBS", "biapenem")),
    diet_treatment = factor(diet_treatment, levels = c("vehicle", "sucrose"))
  ) %>%
  # Create a single grouping variable for the x-axis by combining the treatment and day information.
  mutate(
    plot_group = paste(antibiotic_treatment, diet_treatment, day_relative_to_antibiotics, sep = "_"),
    # Create a unique ID for each mouse's trajectory within its specific treatment group.
    trajectory_group = paste(antibiotic_treatment, diet_treatment, mouse_identifier, sep = "_")
  ) %>%
  # Convert the new grouping variable to a factor and set the levels to enforce the desired plot order.
  mutate( 
    plot_group = factor(plot_group, levels = c(
      "PBS_vehicle_-7", "PBS_vehicle_0", "PBS_vehicle_3", "PBS_vehicle_6",
      "PBS_sucrose_-7",  "PBS_sucrose_0", "PBS_sucrose_3", "PBS_sucrose_6",
      "biapenem_vehicle_-7", "biapenem_vehicle_0", "biapenem_vehicle_3", "biapenem_vehicle_6",
      "biapenem_sucrose_-7", "biapenem_sucrose_0", "biapenem_sucrose_3", "biapenem_sucrose_6"
    ))
  )

ggplot(processed_data, aes(x = plot_group, y = logCFU, fill = diet_treatment)) +
  
  # Add vertical lines to visually separate the main treatment blocks.
  geom_vline(xintercept = c(4.5, 8.5, 12.5), color = "gray80", linetype = "dashed") +

  # Add boxplots. The fill color is mapped to the diet treatment.
  # Outliers are not plotted here as geom_jitter will show all individual points.
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  
   # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray50", linewidth = 0.5, alpha = 0.7) +
  
  # Add individual data points with some horizontal jitter to prevent overlap.
  geom_point(aes(color = diet_treatment), width = 0.2, size = 2) +
  
  # Use a logarithmic scale for the y-axis, which is essential for this type of CFU data.
  # We customize the labels to show scientific notation (10^2, 10^3, etc.).
  # scale_y_log10(
  #   breaks = scales::trans_breaks("log10", function(x) 10^x, n = 9),
  #   labels = scales::trans_format("log10", scales::math_format(10^.x))
  # ) +
  
  # Set the x-axis tick labels to show the day for each group.
  #scale_x_discrete(labels = rep(c("-7","0", "3", "6"), 4)) +
  
  # Manually set the colors to match the publication figure (gray for vehicle, pink for sucrose).
  scale_fill_manual(values = c("vehicle" = "gray", "sucrose" = "#FF69B4")) +
  scale_color_manual(values = c("vehicle" = "gray40", "sucrose" = "red")) +
  
  # Add labels for the axes and title.
  labs(
    y = "Enterococcal\nCFU/gram (log10)",
    x = "Treatment Group",
    title = "RB07 in Feb"
  ) +
  # 
  # # Add annotations below the x-axis to label the main groups.
  # annotate("text", x = 2, y = 0.1, label = "PBS\nvehicle", size = 3.5) +
  # annotate("text", x = 5, y = 0.1, label = "PBS\nsucrose", size = 3.5) +
  # annotate("text", x = 8, y = 0.1, label = "Biapenem\nvehicle", size = 3.5) +
  # annotate("text", x = 11, y = 0.1, label = "Biapenem\nsucrose", size = 3.5) +
  
  # Apply a clean, classic theme suitable for publication.
  theme_classic() +
  
  # Further theme adjustments for a polished look.
  theme(
    axis.title = element_text(size = 12),
    axis.text.x = element_text(size = 10, vjust = -1, angle = 90), # Adjust position of day numbers
    axis.text.y = element_text(size = 10),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "none" # Hide the legend as the colors are explained by the fill.
  ) +
  # Extend the plot margin to make room for the annotations.
  coord_cartesian( clip = "off")
```
# EM07

```{r}
experiment_data <- read_csv('../data/7_25_25_biapenem_rebuttal_EM07.xlsx - Sheet1.csv') %>%  
   filter(!is.na(Stool_weight_mg)) %>% clean_names()
```


```{r}
processed_data <- experiment_data %>%
  # Create separate columns for 'antibiotic_treatment' and 'diet_treatment' from the 'group' column.
  mutate(
    antibiotic_treatment = case_when(
      str_detect(treatment, "Biapenem") ~ "biapenem",
      str_detect(treatment, "PBS") ~ "PBS",
      TRUE ~ "Unknown"
    ),
    diet_treatment = case_when(
      str_detect(treatment, "Sucrose") ~ "sucrose",
      str_detect(treatment, "Only") ~ "vehicle",
      TRUE ~ "Unknown"
    ),
    # Ensure the treatments are ordered correctly for the plot layout.
    antibiotic_treatment = factor(antibiotic_treatment, levels = c("PBS", "biapenem")),
    diet_treatment = factor(diet_treatment, levels = c("vehicle", "sucrose"))
  ) %>%
  # Create a single grouping variable for the x-axis by combining the treatment and day information.
  mutate(
    plot_group = paste(antibiotic_treatment, diet_treatment, day, sep = "_"),
    # Create a unique ID for each mouse's trajectory within its specific treatment group.
    trajectory_group = paste(antibiotic_treatment, diet_treatment, mouse_identifier, sep = "_")
  ) %>%
  # Convert the new grouping variable to a factor and set the levels to enforce the desired plot order.
  mutate(
    plot_group = factor(plot_group, levels = c(
      "PBS_vehicle_0", "PBS_vehicle_3", "PBS_vehicle_6", 
      "PBS_sucrose_0", "PBS_sucrose_3", "PBS_sucrose_6", 
      "biapenem_vehicle_0", "biapenem_vehicle_3", "biapenem_vehicle_6", 
      "biapenem_sucrose_0", "biapenem_sucrose_3", "biapenem_sucrose_6"
    ))
  )

ggplot(processed_data, aes(x = plot_group, y = cf_us_per_gram_stool, fill = diet_treatment)) +
  
  # Add vertical lines to visually separate the main treatment blocks.
  geom_vline(xintercept = c(3.5, 6.5, 9.5), color = "gray80", linetype = "dashed") +

  # Add boxplots. The fill color is mapped to the diet treatment.
  # Outliers are not plotted here as geom_jitter will show all individual points.
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  
   # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray50", linewidth = 0.5, alpha = 0.7) +
  
  # Add individual data points with some horizontal jitter to prevent overlap.
  geom_point(aes(color = diet_treatment), width = 0.2, size = 2) +
  
  # Use a logarithmic scale for the y-axis, which is essential for this type of CFU data.
  # We customize the labels to show scientific notation (10^2, 10^3, etc.).
  scale_y_log10(
    breaks = scales::trans_breaks("log10", function(x) 10^x, n = 9),
    labels = scales::trans_format("log10", scales::math_format(10^.x))
  ) +
  
  # Manually set the colors to match the publication figure (gray for vehicle, pink for sucrose).
  scale_fill_manual(values = c("vehicle" = "gray", "sucrose" = "pink")) +
  scale_color_manual(values = c("vehicle" = "gray40", "sucrose" = "red")) +
  
  # Add labels for the axes and title.
  labs(
    y = "Enterococcal\nCFU/gram",
    x = "Treatment Group",
    title = "EM07 July 25"
  ) +
  
  # Apply a clean, classic theme suitable for publication.
  theme_classic() +
  
  # Further theme adjustments for a polished look.
  theme(
    axis.title = element_text(size = 12),
    axis.text.x = element_text(size = 10, vjust = 0, angle = 90), # Adjust position of day numbers
    axis.text.y = element_text(size = 10),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "none" # Hide the legend as the colors are explained by the fill.
  ) +
  # Extend the plot margin to make room for the annotations.
  coord_cartesian( clip = "off")
```

# RB08 comparison

```{r}
experiment_data <- read_csv('../data/7_31_25_biapenem_rebuttal_RB08 - Sheet1.csv') %>%  
   filter(CFUs_per_GramStool > 0) %>% clean_names() %>% 
  select(group, treatment, day , mouse_identifier, cf_us_per_gram_stool) %>%
  mutate(strata = case_when(
    mouse_identifier %in% 1:20 ~ "Water",
    mouse_identifier %in% 21:40 ~ "Plain Hydrogel",
    TRUE ~ NA_character_ # This handles any mouse IDs outside the specified range
  ))

experiment_data %>% count(strata, treatment)
```


```{r}
processed_data <- experiment_data %>%
  # Create separate columns for 'antibiotic_treatment' and 'diet_treatment' from the 'group' column.
  mutate(
    antibiotic_treatment = case_when(
      str_detect(treatment, "^B") ~ "biapenem",
      !str_detect(treatment, "^B") ~ "PBS",
      TRUE ~ "Unknown"
    ),
    diet_treatment = case_when(
       str_detect(treatment, "S$") ~ "sucrose",
       treatment == 'B+W' | treatment == 'W' ~ "regular_water",
      str_detect(treatment, "\\+PH") ~ "plain_hydrogel",
      TRUE ~ "Unknown"
    ),
    # Ensure the treatments are ordered correctly for the plot layout.
    antibiotic_treatment = factor(antibiotic_treatment, levels = c("PBS", "biapenem")),
    diet_treatment = factor(diet_treatment, levels = c("plain_hydrogel","regular_water", "sucrose"))
  ) %>%
  # Create a single grouping variable for the x-axis by combining the treatment and day information.
  mutate(
    plot_group = paste(antibiotic_treatment, diet_treatment, day, sep = "_"),
    # Create a unique ID for each mouse's trajectory within its specific treatment group.
    trajectory_group = paste(antibiotic_treatment, diet_treatment, mouse_identifier, sep = "_"))


```

```{r}
ggplot(processed_data, aes(x = plot_group, y = cf_us_per_gram_stool)) +
  
  # Add vertical lines to visually separate the main treatment blocks.
  #geom_vline(xintercept = c(3.5, 6.5, 9.5), color = "gray80", linetype = "dashed") +

  # Add boxplots. The fill color is mapped to the diet treatment.
  # Outliers are not plotted here as geom_jitter will show all individual points.
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  
   # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray50", linewidth = 0.5, alpha = 0.7) +
  
  # Add individual data points with some horizontal jitter to prevent overlap.
  geom_point(aes(color = diet_treatment), width = 0.2, size = 2) +
  
  # Use a logarithmic scale for the y-axis, which is essential for this type of CFU data.
  # We customize the labels to show scientific notation (10^2, 10^3, etc.).
  scale_y_log10(
    breaks = scales::trans_breaks("log10", function(x) 10^x, n = 9),
    labels = scales::trans_format("log10", scales::math_format(10^.x))
  ) +
  facet_wrap(~ strata , scales = 'free_x') +
  # Manually set the colors to match the publication figure (gray for vehicle, pink for sucrose).
  #scale_fill_manual(values = c("vehicle" = "gray", "sucrose" = "pink")) +
  #scale_color_manual(values = c("vehicle" = "gray40", "sucrose" = "red")) +
  
  # Add labels for the axes and title.
  labs(
    y = "Enterococcal\nCFU/gram",
    x = "Treatment Group",
    title = "RB08"
  ) +
  
  # Apply a clean, classic theme suitable for publication.
  theme_classic() +
  
  # Further theme adjustments for a polished look.
  theme(
    axis.title = element_text(size = 12),
    axis.text.x = element_text(size = 10, vjust = 0, angle = 90), # Adjust position of day numbers
    axis.text.y = element_text(size = 10),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "none" # Hide the legend as the colors are explained by the fill.
  ) +
  # Extend the plot margin to make room for the annotations.
  coord_cartesian( clip = "off")
```

# sugar delayed 

## design

```{r}
# Define the experimental groups and their properties


groups <- tibble(
  group_name = factor(
    c("Abx + Sucrose (Standard)", "Abx + Sucrose (Delay +1)", "Abx + Sucrose (Delay +2)", "PBS + Sucrose", "PBS + Water", "Abx + Water"),
    levels = c( "PBS + Sucrose", "PBS + Water", "Abx + Sucrose (Delay +2)", "Abx + Sucrose (Delay +1)", "Abx + Sucrose (Standard)", "Abx + Water")
  ),
  injection_type = c("Abx", "Abx", "Abx", "PBS", "PBS", "Abx"),
  treatment_type = c("Sucrose_water", "Sucrose_water", "Sucrose_water", "Sucrose_water", "Regular_water", "Regular_water"),
  treatment_start = c(1, 2, 3, 1, 1, 1),
  treatment_end = c(6, 6, 6, 6, 6, 6)
)

# --- Prepare data for plotting ---

# Data for the treatment rectangles (sucrose/water)
# Adding a small buffer to the end day for better visualization
treatment_rects <- groups %>%
  mutate(
    ymin = as.numeric(group_name) ,
    ymax = as.numeric(group_name) + 0.3,
    xmin = treatment_start-0.1,
    xmax = treatment_end+0.1  
  )

# Data for the stool collection points (triangles)
stool_collection <- groups %>%
  select(group_name) %>%
  crossing(day = c(1, 3, 6)) %>%
  mutate(y = as.numeric(group_name))

# Data for the injection points (arrows)
injections <- groups %>%
  select(group_name, injection_type) %>%
  mutate(
    y = as.numeric(group_name) + 0.25,
    day = 1
    )

# --- Create the plot ---
design <- ggplot() +
  # Add shaded rectangles for sucrose/water treatment periods
  geom_rect(
    data = treatment_rects,
    aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, fill = treatment_type),
    alpha = 0.3
  ) +
  # Add the main timeline for each group
  geom_segment(
    data = groups,
    aes(x = 1, xend = 6, y = as.numeric(group_name), yend = as.numeric(group_name)),
    color = "gray50",
    linewidth = 1
  ) +
  # Add arrows for Abx/PBS injections on Day 1
  geom_segment(
    data = injections,
    aes(x = day+0.05, xend = day+0.05, y = y + 0.2, yend = y),
    arrow = arrow(length = unit(0.2, "cm")),
    color = "black",
    linewidth = 0.8
  ) +
  # Add labels for the injections
  geom_text(
    data = injections,
    aes(x = day+0.05, y = y + 0.35, label = injection_type),
    fontface = "bold",
    size = 2.5
  ) +
  # Add triangles for stool collection days
  geom_point(
    data = stool_collection,
    aes(x = day, y = y),
    shape = 17, # Triangle shape
    size = 2.5,
    color = "black" # A reddish color
  ) +
  # Customize colors for treatments
  scale_fill_manual(
    name = "Diet Treatment",
    values = c("Sucrose_water" = "#F8766D", "Regular_water" = "#999999")
  ) +
  # Set the labels for the y-axis
  scale_y_continuous(
    breaks = 1:length(levels(groups$group_name)),
    labels = levels(groups$group_name),
    limits = c(0.5, length(levels(groups$group_name)) + 1)
  ) +
  # Set the labels and limits for the x-axis
  scale_x_continuous(
    name = "Day",
    breaks = 1:6,
    limits = c(.8, 6.5)
  ) +
  # Add titles and theme
  labs(
    title = "Experimental Design for Sucrose Delay Study",
    #subtitle = "Timeline of treatments and sample collections for each group",
    y = "Experimental Group"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
    plot.subtitle = element_text(hjust = 0.5, size = 11),
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 11, face = "bold"),
    legend.position = "top"
  )
ggsave('../data/R31_delay_design.jpg')
```
## CFU

```{r}
# It's good practice to define the file paths first.
# Replace these with the actual paths to your files.
file_exp1 <- "../data/8_6_25_Biapenem_Sugar_Delay_1 - sheet1.csv"
file_exp2 <- "../data/8_8_25_Biapenem_Sugar_Delay_2 - sheet1.csv"

# Read the first CSV file into a data frame.
# The mutate() function then adds a new column called 'experiment',
# labeling all rows from this file as "Experiment 1".
exp1_data <- read_csv(file_exp1) %>%
  mutate(experiment_no = "Experiment_1")

# Do the same for the second CSV file, labeling these rows as "Experiment 2".
exp2_data <- read_csv(file_exp2) %>%
  mutate(experiment_no = "Experiment_2",
         `Mice Weights` = as.numeric(`Mice Weights`)) # two mice died 


# --- Combine the Data ---

# The bind_rows() function stacks the two data frames on top of each other.
# It automatically matches columns by their names, which is perfect for this task.
combined_data <- bind_rows(exp1_data, exp2_data) %>% 
  mutate(CFUs_per_GramStool = (((((Colonies_counted*(100/Plated_volume_ul))/100)/(10^Dilution_factor) )*1000)/Stool_weight_mg)+1)  %>%
  clean_names() %>%
  mutate(log10_cf_us_per_gram_stool = log10(cf_us_per_gram_stool)) %>% 
  mutate(
    # Create a unique ID for each mouse's trajectory within its specific treatment group.
    trajectory_group = paste(treatment, mouse_identifier, sep = "_")
  ) %>% 
  relocate(log10_cf_us_per_gram_stool, .after = 'mice_weights') %>% 
  relocate(experiment_no, .after = 'log10_cf_us_per_gram_stool') 
```


```{r}
ggplot(combined_data, aes(x = factor(day), y = cf_us_per_gram_stool)) +
  # Use a boxplot to show the distribution of CFU/g at each day.
  # A small value (1) is added to cfu_per_gram to avoid issues with taking the log of zero.
  geom_boxplot( outlier.shape = NA) +
  # Add individual data points with some jitter to see the raw data.
  geom_point( alpha = 0.6) +

  # Facet the plot by the cleaned treatment names.
  # `scales = "free_x"` allows each panel to have its own x-axis range if needed.
  facet_grid(~treatment, scales = "free_x") +
  # Add thin lines to track the trajectory of each individual mouse.
  geom_line(aes(group = trajectory_group), color = "gray50", linewidth = 0.5, alpha = 0.5) +

  # Use a log10 scale for the y-axis, which is standard for CFU data.
  # The `label_log()` function from the 'scales' package creates nice labels (e.g., 10^6).
  scale_y_log10(
    breaks = trans_breaks("log10", function(x) 10^x),
    labels = trans_format("log10", math_format(10^.x))
  ) +
  # Add minor tick marks for the log scale, which helps with readability.
  #annotation_logticks(sides = "l") +

  # Add labels and a title to make the plot informative.
  labs(
    #title = "Enterococcus Burden by Treatment Group and Day",
    x = "Day of Experiment",
    y = "Enterococcus (CFU / gram of feces)",
    fill = "Treatment Group" # Title for the legend
  ) +

  # Use a clean, minimal theme and adjust some settings for clarity.
  theme_light(base_size = 14) +
  theme(
    legend.position = "none", # The facets already label the groups, so no legend is needed.
    strip.text = element_text(face = "bold"), # Make the facet titles bold.
    axis.text.x = element_text(angle = 0, hjust = 1) # Rotate x-axis labels if they overlap.
  )

ggsave('../data/R31_sugar_delay.png', width = 12, height = 6)
```

## AUC vardi

### vardi

```{r}
library(clinfun)

# The recode step is done once here to prepare the full dataset.
# This makes the names consistent for all subsequent tests.
prepared_data <- combined_data %>%
  mutate(treatment = recode(treatment,
    "Biapenem_Only" = "Abx + Water",
    "Biapenem_Sucrose_reg" = "Abx + Sucrose (Standard)",
    "Biapenem_Sucrose_+1" = "Abx + Sucrose (Delay +1)",
    "Biapenem_Sucrose_+2" = "Abx + Sucrose (Delay +2)",
    "PBS_Only" = "PBS + Water",
    "PBS_Sucrose" = "PBS + Sucrose"
  ))

# --- 3. Run Vardi Test for Each Sucrose Group vs. Control ---

# A list of the sucrose groups to compare against the control.
sucrose_groups <- c(
  "Abx + Sucrose (Standard)",
  "Abx + Sucrose (Delay +1)",
  "Abx + Sucrose (Delay +2)"
)
```


```{r}
vardidf <- prepared_data %>% 
  mutate(mouse_identifier = str_glue('{experiment_no}_{mouse_identifier}')) %>% 
  select(treatment:mouse_identifier, log10_cf_us_per_gram_stool) %>% 
  spread('day','log10_cf_us_per_gram_stool') 

vardicts <- vardidf %>% 
  select(-mouse_identifier, -treatment) %>% as.matrix()

vardigrp <- vardidf$treatment
  
# Make pairwise comparisons between all the groups
combos.to.test <-  data.frame(combn(unique(vardigrp),2))
combos.to.test[] <- lapply(combos.to.test, as.character)
stats.results <- plyr::ldply(combos.to.test, function(x) {
  # x <- combos.to.test[[1]]
  paste(x)
  u <- aucVardiTest(vardicts, vardigrp, tim = c(1, 3, 6), cgrps=x) 
  u$p.value
  return(data.frame(Grp.Vs = x[1],
                    Gr = x[2],
                    p.value = round(u$p.value, 3)))
}) 


#set thresholds for what asterisks mean
stats.results$.id <- NULL
p.value.star <- 0.05      
p.value.double <- 0.01

stats.results$sig[stats.results$p.value > p.value.star] <- " "
stats.results$sig[stats.results$p.value <= p.value.star] <- "*"
stats.results$sig[stats.results$p.value <= p.value.double] <- "**"
print(stats.results, row.names = F)
 stats.results %>% 
   filter()
```



```{r}
library(DescTools)

auc_data <- combined_data %>%
  group_by(experiment_no, treatment, mouse_identifier) %>%
  # Arrange data by day for correct AUC calculation
  arrange(day, .by_group = TRUE) %>%
  # Calculate the AUC using the trapezoidal rule from the DescTools package.
  # This is robust to missing time points for some mice.
  # The 'na.rm = TRUE' handles cases where a mouse might have only one time point.
  summarise(
    auc = AUC(x = day, y = log10_cf_us_per_gram_stool, na.rm = TRUE),
    .groups = 'drop' # Ungroup the data after summarising
  )
```

```{r}
# Perform a Kruskal-Wallis test, which is a non-parametric method
# to see if there are significant differences in AUC among the treatment groups.
# This is appropriate because the AUC values may not be normally distributed.
kruskal_test_result <- kruskal.test(auc ~ treatment , data = auc_data %>% filter(str_detect(treatment, 'Biapenem_Sucrose')) )

# Print the results of the statistical test
print("Kruskal-Wallis test for differences in AUC between treatment groups:")
print(kruskal_test_result)
```

```{r}
# --- Visualize AUC Data ---

# Clean up treatment names for better plot labels
auc_data_viz <- auc_data %>%
  mutate(treatment = recode(treatment,
    "Biapenem_Only" = "Abx + Water",
    "Biapenem_Sucrose_reg" = "Abx + Sucrose (Standard)",
    "Biapenem_Sucrose_+1" = "Abx + Sucrose (Delay +1)",
    "Biapenem_Sucrose_+2" = "Abx + Sucrose (Delay +2)",
    "PBS_Only" = "PBS + Water",
    "PBS_Sucrose" = "PBS + Sucrose"
  ))

# Define the desired order for the treatment groups on the plot
treatment_order <- c(
  "PBS + Sucrose", 
  "PBS + Water", 
  "Abx + Sucrose (Delay +2)", 
  "Abx + Sucrose (Delay +1)", 
  "Abx + Sucrose (Standard)", 
  "Abx + Water"
)

# Set the treatment column as a factor with the specified order
auc_data_viz$treatment <- factor(auc_data_viz$treatment, levels = treatment_order)

# Define the new color palette for the groups
color_palette <- c(
  "PBS + Water" = "lightgray",
  "PBS + Sucrose" = "lightpink",
  "Abx + Water" = "gray32",
  "Abx + Sucrose (Standard)" = "deeppink2",
  "Abx + Sucrose (Delay +1)" = "deeppink2",
  "Abx + Sucrose (Delay +2)" = "deeppink2"
)

# Define the specific comparisons for the p-values
comparison_list <- list(
  c("Abx + Water", "Abx + Sucrose (Standard)"),
  c("Abx + Water", "Abx + Sucrose (Delay +1)"),
  c("Abx + Water", "Abx + Sucrose (Delay +2)")
)

# Create the boxplot
auc_plot <- ggplot(auc_data_viz, aes(x = treatment, y = auc, color = treatment)) +
  # Boxplot now uses color for the outline and has no fill
  geom_boxplot(outlier.shape = NA, fill = NA, linewidth = 1) +
  # Overlay individual data points
  geom_jitter(width = 0.2, size = 2.5) +
  # Apply the custom color palette
  scale_color_manual(values = color_palette) +
  # Add statistical comparisons
  stat_compare_means(
    comparisons = comparison_list,
    method = "wilcox.test", # Use Wilcoxon rank-sum test
    label = "p.format",      # Display the formatted p-value
    tip.length = 0.01
  ) +
  # Flip coordinates to make labels easier to read
  coord_flip(ylim = c(0, max(auc_data_viz$auc, na.rm = TRUE) * 1.23)) + # Adjust y-limit for p-values
  # Add labels and title
  labs(
    title = "Total Enterococcus Burden (AUC) by Treatment Group",
    subtitle = "Comparison of AUC across different treatment conditions",
    x = "Treatment Group",
    y = "Area Under the Curve (log10 CFU/gram * days)"
  ) +
  # Use a clean theme
  theme_classic() +
  theme(
    legend.position = "none", # Hide legend as colors are on the axis
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.y = element_text(face = "bold")
  )

# Print the plot
print(auc_plot)


```

```{r}
final_plot <-  plot_grid(design, auc_plot, 
                 label_size = 12, ncol = 1,labels = c('A','B'),
                align = 'vh', axis = 'lrtb')

title <- ggdraw() + 
  draw_label("Rebuttal Fig X",fontface = 'bold',x = 0,hjust = 0) +
  theme(plot.margin = margin(0, 0, 0, 0))

combined <- plot_grid(
  title, final_plot,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
) +theme(plot.margin = unit(c(1,1,1,1), "cm"))

ggsave('../data/R31_delayed_sugar.pdf',
      width = 8.5, height = 11, units = "in", device = 'pdf', 
      dpi = 300)  
```

